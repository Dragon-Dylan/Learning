#include"NEEDED.H"

void CLogin(struct UserNode* head, struct UserNode* ipass, struct UserType u)
{
	if(head == NULL)	return;

	FILE *fp;
	struct UserNode* p = head->next;
	if((fp = fopen("USER.TXT", "r")) == NULL)
	{
		printf("Connot open the file.\n");
		return;
	}
	while(1)
	{
		struct UserNode* q;
		int nRead = fscanf(fp, "%s%s%d", p->Pass.Name, p->Pass.Passwords, &p->Identity);
		if(p->Pass.Name == ipass->Pass.Name && p->Pass.Passwords == ipass->Pass.Passwords)
		{
			strcpy(u.Pass.Name, p->Pass.Name);
			strcpy(u.Pass.Passwords, p->Pass.Passwords);
			u.Identity = p->Identity;
			break;
		}
		if(nRead == 4)
		{
			p->next = q;
			p = q;
		}
		else
			break;
	}
	p->next = NULL;
	fclose(fp);
}

void Login(struct UserType u)
{
	//Read user information
	struct UserNode* ipass = (struct UserNode*)calloc(1, sizeof(struct UserNode));
	printf("Please enter your username: ");
	scanf("%s", ipass->Pass.Name);
	getchar();
	printf("Please enter your passwords: ");
	scanf("%s", ipass->Pass.Passwords);
	getchar();
	ipass->Identity = 0;
	ipass->next = NULL;

	//Privacy protection?

	//Verify user information
	struct UserNode* head;
	head = (struct UserNode*)calloc(1, sizeof(struct UserNode));
	head->next = NULL;
	CLogin(head, ipass, u);
	free(head);
	free(ipass);

	if(u.Pass.Name == "Visitor")
	{
		printf("Sign in successfully.\n");
		Interface();
	}
	else
	{
		printf("Not find the account.(Enter again please!)");
		getchar();
		main();

	}
}
